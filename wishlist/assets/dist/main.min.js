!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function e(e){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?t(Object(i),!0).forEach((function(t){r(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):t(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function n(t,e,n,i,r,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(i,r)}function i(t){return function(){var e=this,i=arguments;return new Promise((function(r,s){var o=t.apply(e,i);function a(t){n(o,r,s,a,c,"next",t)}function c(t){n(o,r,s,a,c,"throw",t)}a(void 0)}))}}function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function s(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,a(t,e,"get"))}function o(t,e,n){return function(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}(t,a(t,e,"set"),n),n}function a(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function c(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}var l={message:"dcaw-message",box:"dcaw-messages-wrapper"},u=4e3,d=5,h=function(){var t=document.querySelector(".".concat(l.box)),e=[];function n(t){return e.find((e=>e.element===t))}function i(i){var r=n(i);clearTimeout(r.timeout),t.removeChild(r.element),e=e.filter((t=>t!==r))}function r(t){return setTimeout((()=>{i(t)}),u)}return{show:(s,o)=>{t||((t=document.createElement("div")).classList.add(l.box),document.body.appendChild(t));var a=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",n=document.createElement("div");return n.classList.add(l.message,"is-".concat(e)),n.textContent=t,n}(s,o),c=r(a);e.length>=d&&i(e[0].element),e.push({element:a,timeout:c}),function(e){var{timeout:s}=n(e);t.appendChild(e),e.addEventListener("click",(t=>{t.stopPropagation(),clearTimeout(s),i(e)})),e.addEventListener("mouseover",(()=>{clearTimeout(s)})),e.addEventListener("mouseleave",(()=>{s=r(e)}))}(a)}}},p=new WeakMap,f=new WeakMap,v=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,b=new WeakMap;class E{constructor(t){var e,n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c(this,p,{writable:!0,value:(e={},{on:(t,n)=>{t.split(" ").forEach((t=>{(e[t]=e[t]||[]).push(n)}))},off:(t,n)=>{t.split(" ").forEach((t=>{e[t]=(e[t]||[]).filter((t=>t!==n))}))},emit:function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(e[t]||[]).forEach((t=>t(...i)))},destroy:()=>e={}})}),c(this,f,{writable:!0,value:h()}),c(this,v,{writable:!0,value:{}}),c(this,m,{writable:!0,value:void 0}),c(this,g,{writable:!0,value:[]}),c(this,y,{writable:!0,value:[]}),c(this,w,{writable:!0,value:[]}),c(this,b,{writable:!0,value:void 0}),r(this,"mount",(()=>{s(this,m).get().then((t=>{t.ok&&(o(this,g,t.data),this.initCounters(),this.initTables(),this.initEvents(),this.emit("mount"))}))})),r(this,"onMaximum",(t=>{this.show(t.message,"info")})),r(this,"onDeleteProduct",(t=>{this.show(t.message,"info")})),r(this,"onPostProduct",(t=>{this.show(t.message)})),r(this,"initCounters",(()=>{var{selectors:t,classes:e}=s(this,v);document.querySelectorAll(t.counters).forEach((t=>{var n=document.createElement("span");n.classList.add(e.counter,e.empty),s(this,y).push(n),t.appendChild(n)}))})),r(this,"updateCounters",(()=>{var t=s(this,g).reduce(((t,e)=>{if(e.products)return t+e.products.length}),0),{classes:{empty:e}}=s(this,v);s(this,y).forEach((n=>{t?(n.textContent=t.toString(),n.classList.remove(e)):(n.classList.add(e),n.textContent="")}))})),r(this,"initTables",(()=>{document.querySelectorAll(s(this,v).selectors.tables).forEach((t=>{s(this,w).push(t)}))})),r(this,"updateTables",(()=>{s(this,w).forEach(function(){var t=i((function*(t){n.emit("loading",!0,t);var e=yield n.rest.get("table");t.innerHTML=e.data,n.emit("loading",!1,t)}));return function(e){return t.apply(this,arguments)}}())})),r(this,"onLoading",(function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e instanceof Element){var i=t?"add":"remove";e.classList[i](s(n,v).classes.loading)}})),r(this,"documentClickHandler",function(){var t=i((function*(t){var{selectors:{button:e}}=s(n,v);if(t.target.closest(e)){t.preventDefault();var{selectors:{button:i},classes:{active:r}}=s(n,v),o=t.target.closest(i),a=parseInt(o.dataset.id);n.emit("loading",!0,o);try{var c=s(n,g).some((t=>{if(t.products&&t.products.includes(a))return!0}));c?(o.classList.remove(r),yield n.deleteProduct(a)):(yield n.postProduct(a),o.classList.add(r))}catch(t){n.onError(t)}finally{n.emit("loading",!1,o),n.emit("updated")}}}));return function(e){return t.apply(this,arguments)}}()),r(this,"postProduct",function(){var t=i((function*(t,e){var i=yield s(n,m).post("product/".concat(t),e);if(!i.ok)throw i;return o(n,g,i.data),n.emit("post-product",i),i}));return function(e,n){return t.apply(this,arguments)}}()),r(this,"deleteProduct",function(){var t=i((function*(t,e){var i=yield s(n,m).delete("product/".concat(t),e);if(!i.ok)throw i;return o(n,g,i.data),n.emit("delete-product",i),i}));return function(e,n){return t.apply(this,arguments)}}()),r(this,"on",((t,e)=>(s(this,p).on("".concat(s(this,b),":").concat(t),e),this))),r(this,"off",((t,e)=>(s(this,p).off("".concat(s(this,b),":").concat(t),e),this))),r(this,"emit",(function(t){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return s(n,p).emit("".concat(s(n,b),":").concat(t),...i),n})),r(this,"destroy",(function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return n.emit("".concat(s(n,b),":destroy"),t),s(n,p).destroy(),n})),r(this,"show",(function(){s(n,f).show(...arguments)})),o(this,v,a),o(this,b,t);var{nonce:l,rest:u}=s(this,v);o(this,m,function(t){var e,n,r,s,o=t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=function(){var t=i((function*(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;try{e=n?"".concat(e,"/").concat(n):e;var s={method:t,headers:new Headers({"Content-Type":"application/json","X-WP-Nonce":i.nonce}),body:r},o=yield fetch(e,s);return yield o.json()}catch(t){throw new Error(t)}}));return function(e,n,i){return t.apply(this,arguments)}}();return{get:(s=i((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return yield c("GET",o,t,a)})),function(){return s.apply(this,arguments)}),post:(r=i((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return yield c("POST",o,t,a,e)})),function(){return r.apply(this,arguments)}),delete:(n=i((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return yield c("DELETE",o,t,a,e)})),function(){return n.apply(this,arguments)}),patch:(e=i((function*(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return yield c("PATCH",o,t,a,e)})),function(){return e.apply(this,arguments)})}}(u+"/"+t,{nonce:l}))}initEvents(){this.on("loading",this.onLoading),this.on("max",this.onMaximum),this.on("post-product",this.onPostProduct),this.on("delete-product",this.onDeleteProduct),this.on("mount",this.updateCounters),this.on("updated",this.updateCounters),this.on("updated",this.updateTables),document.addEventListener("click",this.documentClickHandler)}onError(t){t.code&&this.emit(t.code,t)}get options(){return s(this,v)}get rest(){return s(this,m)}get store(){return s(this,g)}set store(t){o(this,g,t)}get tables(){return s(this,w)}}var L=new WeakMap;class k extends E{constructor(){var t,e=()=>super.onError;super("wishlist",arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),t=this,c(this,L,{writable:!0,value:[]}),r(this,"updateMovedProducts",(()=>{this.tables.forEach((t=>{var e=t.querySelectorAll('input[name="move_products"]');o(this,L,Array.from(e).filter((t=>t.checked)).map((t=>parseInt(t.value))))}))})),r(this,"tableSubmitHandler",function(){var e=i((function*(e){e.preventDefault();var n=new FormData(e.target);switch(e.target.dataset.name){case"edit_list":yield t.patchList(n.get("id"),JSON.stringify({id:n.get("id"),title:n.get("title")}));break;case"move_products":if(!s(t,L).length)return;yield t.patchList(n.get("prev_list"),JSON.stringify({prev_list:n.get("prev_list"),next_list:n.get("next_list"),products:s(t,L)}))}t.emit("updated")}));return function(t){return e.apply(this,arguments)}}()),r(this,"tableClickHandler",function(){var e=i((function*(e){e.target.closest("[data-action]")&&(e.preventDefault(),yield t.buttonActions(e.target.closest("[data-action]"))),e.target.closest(t.options.selectors.remove)&&(e.preventDefault(),yield t.removeProductBtn(e.target.closest(t.options.selectors.remove)))}));return function(t){return e.apply(this,arguments)}}()),r(this,"buttonActions",function(){var n=i((function*(n){var i=n.dataset.id,r=n.dataset.action;t.emit("loading",!0,n);try{switch(r){case"delete":yield t.deleteList(i);break;case"default":yield t.patchList(i,JSON.stringify({default:!0}));break;case"share":yield t.shareList(i)}}catch(n){e().call(t,n)}finally{t.emit("loading",!1,n),t.emit("updated")}}));return function(t){return n.apply(this,arguments)}}()),r(this,"removeProductBtn",function(){var e=i((function*(e){var n=parseInt(e.dataset.id),i=e.dataset.listId;t.emit("loading",!0,e);try{yield t.deleteProduct(n,JSON.stringify({list_id:i}))}catch(e){t.onError(e)}finally{t.emit("loading",!1,e),t.emit("updated")}}));return function(t){return e.apply(this,arguments)}}()),r(this,"createWishlistBtnHandler",function(){var n=i((function*(n){n.preventDefault();var i=n.currentTarget;t.emit("loading",!0,i);try{yield t.createList()}catch(n){e().call(t,n)}finally{t.emit("loading",!1,i),t.emit("updated")}}));return function(t){return n.apply(this,arguments)}}()),r(this,"shareList",function(){var e=i((function*(e){var n=yield t.rest.get("list/share/".concat(e));if(!n.ok)throw n;return t.emit("shared-list",n),n}));return function(t){return e.apply(this,arguments)}}()),r(this,"createList",i((function*(){var e=yield t.rest.post("list");if(!e.ok)throw e;return t.store=e.data,t.emit("post-list",e),e}))),r(this,"patchList",function(){var e=i((function*(e,n){var i=yield t.rest.patch("list/".concat(e),n);if(!i.ok)throw i;return t.store=i.data,t.emit("patch-list",i),i}));return function(t,n){return e.apply(this,arguments)}}()),r(this,"deleteList",function(){var e=i((function*(e){var n=yield t.rest.delete("list/".concat(e));if(!n.ok)throw n;return t.store=n.data,t.emit("delete-list",n),n}));return function(t){return e.apply(this,arguments)}}()),r(this,"onGuestClick",(t=>{this.show(t.message),window.location.href=this.options.accountLink})),r(this,"onShareList",(t=>{var e,n;e=t.data,(n=document.createElement("textarea")).value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),this.show(t.message)})),r(this,"onPostList",(t=>{this.show(t.message)})),r(this,"onDeleteList",(t=>{this.show(t.message,"warning")})),r(this,"onPatchList",(t=>{this.show(t.message,"info")}))}initEvents(){super.initEvents(),this.on("guest",this.onGuestClick),this.on("shared-list",this.onShareList),this.on("post-list",this.onPostList),this.on("delete-list",this.onDeleteList),this.on("patch-list",this.onPatchList),this.on("loading",this.updateMovedProducts),document.querySelectorAll(this.options.selectors.createWishlist).forEach((t=>{t.addEventListener("click",this.createWishlistBtnHandler)})),this.tables.forEach((t=>{t.addEventListener("click",this.tableClickHandler),t.addEventListener("submit",this.tableSubmitHandler),t.addEventListener("change",this.updateMovedProducts)}))}}class P extends E{constructor(){var t,e=()=>super.onError;super("compare",arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),t=this,r(this,"tableClickHandler",function(){var n=i((function*(n){if(n.target.closest('[data-action="clear"]')){n.preventDefault();var i=n.target.closest('[data-action="clear"]');t.emit("loading",!0,i);try{yield t.clearCompare()}catch(n){e().call(t,n)}finally{t.emit("loading",!1,i),t.emit("updated")}}if(n.target.closest(t.options.selectors.remove)){n.preventDefault();var r=n.target.closest(t.options.selectors.remove),s=parseInt(r.dataset.id);t.emit("loading",!0,r);try{yield t.deleteProduct(s)}catch(n){t.onError(n)}finally{t.emit("loading",!1,r),t.emit("updated")}}n.target.closest(t.options.selectors.collapse)&&(n.preventDefault(),n.target.closest(t.options.selectors.collapse).parentNode.classList.toggle(t.options.classes.collapse))}));return function(t){return n.apply(this,arguments)}}()),r(this,"clearCompare",i((function*(){var e=yield t.rest.delete();if(!e.ok)throw e;return t.store=e.data,t.emit("cleared",e),e})))}initEvents(){super.initEvents(),this.tables.forEach((t=>{t.addEventListener("click",this.tableClickHandler)}))}}var C,O,j,D,T,S="is-active",x=".js-dcaw-dropdown",M=(j=!0,D=t=>{j||O.contains(t.target)||(O.classList.remove(S),j=!0,document.removeEventListener("click",D,!0))},T=t=>{(C=t.target.closest(x))&&(t.preventDefault(),t.stopPropagation(),(O=C.parentNode).classList.contains(S)?(O.classList.remove(S),j=!0):(O.classList.add(S),j=!1,document.addEventListener("click",D,!0)))},{mount:()=>{document.addEventListener("click",T)}});document.addEventListener("DOMContentLoaded",(()=>{(M.mount(),"object"==typeof dcawCompare&&"object"==typeof dcawGeneral)&&new P(e(e({},dcawGeneral),dcawCompare)).mount();"object"==typeof dcawWishlist&&"object"==typeof dcawGeneral&&new k(e(e({},dcawGeneral),dcawWishlist)).mount()}))}));
